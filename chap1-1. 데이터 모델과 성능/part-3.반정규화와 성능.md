## PART 3. 반정규화와 성능

### ✅ 반정규화 (Denormalization)
: 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 개발과 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링의 기법이다. </br>
→ 일반적으로 정규화시 입력 / 수정 / 삭제 성능이 향상되며 반정규화시 조인 성능이 향상된다.
: 데이터 중복을 허용하여 조인을 중리는 DB 성능 향상 방법이다. </br>
→ 데이터의 무결성을 희생하고 조회 성능을 향상시킨다.

### ✅ 반정규화 절차
🔹**반정규화 대상 조사** (데이터 처리 범위, 처리 빈도수, 통계성 등)
1. 자주 사용되는 테이블에 접근하는 프로세스의 수가 많고 항상 일정한 범위만을 조회하는 경우
2. 테이블의 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리하는 경우에 처리범위를 일정하게 줄이지 않으면 성능을 보장할 수 없는 경우
3. 통계성 프로세스에 의해 통계 정보를 필요로 할 때 별도의 통계 테이블을 생성한다.
4. 테이블에 지나치게 많은 조인이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우 </br>

✔️ SORTING, ORDER BY는 반정규화 대상 ❌

🔹 **다른 방법 유도 검토** (뷰, 클러스터링, 인덱스, 애플리케이션)

1. 지나치게 많은 조인이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우 VIEW를 사용한다.
2. 대량의 데이터처리나 부분처리에 의해 성능이 저하되는 경우 클러스터링을 적용하거나 인덱스를 조정한다. </br>
   ✔️ 클러스터링(Clustering): 물리적인 저장 효율성과 조회(SELECT) 성능 향상을 목적으로 사용되는 기법. </br>
   물리적인 저장 구조를 변경하여 관련있는 데이터를 디스크 상에서 가깝게 배치함으로써 I/O(입출력) 효율을 높이는 전략.
3. 대량의 데이터는 PK의 성격에 따라 부분적인 테이블로 분리할 수 있다. (파티셔닝 기법)
4. 응용 애플리케이션에서 로직을 구사하는 방법을 변경함으로써 성능을 향상시킬 수 있다.

🔹 **반정규화 적용** (정규화 수행 후 반정규화 수행 → 테이블, 속성, 관계 반정규화)

### ✅ 반정규화 기법(테이블, 컬럼, 관계)

**🔶 테이블 반정규화**

**🔹 테이블 병합** ( 1:1 관계, 1:M 관계, 슈퍼/서브타입 )
1. 1:1 관계를 통합하여 성능 향상
2. 1:M 관계를 통합하여 성능 향상 - 많은 데이터 중복 발생
3. 슈퍼/서브 관계를 통합하여 성능 향상

**🔹 테이블 분할** ( 수직 분할, 수평 분할 )
1. **수직 분할** : 컬럼 단위 테이블을 디스크 I/O를 분산처리하기 위해 테이블을 1:1로 분리하여 성능 향상
2. **수평 분할** : 로우 단위로 집중 발생되는 트랜잭션을 분석하여 디스크 I/O 및 데이터 접근의 효율성을 높여 성능을 향상하기 위해 로우 단위로 테이블을 쪼갠다.

**🔹 테이블 추가** ( 중복, 통계, 이력, 부분 테이블 추가 )
1. **중복** : 다른 업무이거나 서버가 다른 경우 **동일한 테이블 구조를 중복**하여 원격 조인을 제거하여 성능을 향상시킨다.
2. **통계** : SUM, AVG 등을 미리 수행하여 계산해 둠으로써 조회 시 성능을 향상시킨다.
3. **이력** : 이력 테이블 중에서 마스터 테이블에 존재하는 레코드를 중복하여 이력 테이블에 존재시켜 성능을 향상시킨다.
4. **부분** : 하나의 테이블의 전체 컬럼 중 자주 이용하는 집중화된 컬럼들이 있을 때 디스크 I/O를 줄이기 위해 해당 컬럼들을 모아놓은 별도의 반정규화된 테이블을 생성한다. </br>
   → 즉, 자주 이용하는 컬럼으로 구성된 테이블을 생성한다.

**🔶 컬럼 반정규화** ( 중복, 파생, 이력, PK, 오작동 )
1. **중복** : 조인에 의해 처리할 때 성능저하를 예방하기 위해 중복된 컬럼을 위치시킨다.
2. **파생** : 트랜잭션이 처리되는 시점에 계산에 의해 발생되는 성능저하를 예방하기 위해 미리 값을 계산하여 컬럼에 보관한다.
   → 즉, 필요한 값 미리 계산한 컬럼을 추가한다.
3. **이력테이블** : 대량의 이력데이터를 처리할 때 불특정 날 조회나 최근 값을 조회할 때 나타날 수 있는 성능저하를 예방하기 위해 이력테이블에 가능성 칼럼(최근값 여부, 시작과 종료일자 등)을 추가한다.
4. **PK에 의한 컬럼 추가** : 이미 PK안에 데이터가 존재하지만 성능향상을 위해 일반속성으로 포함하는 방법
5. **응용시스템 오작동을 위한 컬럼 추가** : 업무적으로는 의미가 없지만 사용자의 실수로 원래 값으로 복구하기 원하는 경우 이전 데이터를 임시적으로 중복하여 보관하는 기법이다.

**🔶 관계 반정규화** : 데이터 무결성 보장 가능
- **중복관계 추가**
  : 데이터를 처리하기 위한 여러 경로를 거쳐 조인이 가능하지만 이 때 발생할 수 있는 성능저하를 예방하기 위해 추가적인 관계를 맺는 방법